# TanStack Start â€¢ TanStack Query â€¢ Betterâ€‘Auth â€¢ Drizzle ðŸš€

A minimal fullâ€‘stack Todo app that demonstrates how to wire together the modern TanStack ecosystem with typeâ€‘safe database access and batteriesâ€‘included authentication.

| Package        | Role                                                                   |
| -------------- | ---------------------------------------------------------------------- |
| TanStack Start | File-based routing, server actions & streaming SSR                     |
| TanStack Query | Declarative data-fetching with caching, mutations & optimistic updates |
| TanStack Form  | Client side form validation                                            |
| Better-Auth    | Authentication & session management (email/password, OAuth, Passkeys)  |
| Drizzle ORM    | Type-safe SQL with PostgreSQL migrations                               |
| Zod            | Schema validation                                                      |

## What's inside?

### Authentication

- Email + Password
  - Sign-up with e-mail verification
  - Forgot / change password flows
- Single-Sign-On
  - Google OAuth 2.0 (drop-in for more providers)
- Passkeys / WebAuthn
  - Password-less sign-in using platform authenticatiors

### App Experience

- Streaming SSR for the first paint
- Light & Dark theme
- CRUD Todo items
  - TanStack Query with loading & error state
  - TanStack Query mutations with optimistic updates
  - TanStack Form + Zod client-side validation
  - Zod server-side validation
  - End-to-end type safety

## Quick Start

### Prerequiste

- Node 20.x.x
- pnpm
- Docker

### Step by Step

_Note:_ This project uses [Resend](https://resend.com/) for email flows. See the email section below for setup.

#### 1. Configure `.env` variables

Look at [.env.example](./.env.example) for reference.

#### 2. Run local db

Use the [docker compose file](./docker-compose.dev.yaml) in this repo to spin up a local db with:

```
docker compose -f docker-compose.dev.yaml up -d
```

#### 3. Install dependencies

```
pnpm install
```

#### 4. Run migrations

Run migrations to populate your local db with the correct schema:

```
pnpm db:migrate
```

#### 5. Run dev server

```
pnpm dev
```

### Email Provider Setup

#### When is email used?

- Email verification on sign-up and email change
- Forgot password flows

If you don't need email functionality, you can skip this section.

#### Using Resend

1. Follow the [Resend Quickstart](https://resend.com/docs/send-with-nodejs) to:
   - Create an API key
   - Verify your domain
2. Add your API key to `.env`

#### Using a Different Email Provider

1. Swap out the Resend client in [/src/features/email/lib/index.ts](/src/features/email/lib/index.ts)
2. Update [/src/features/email/server/services.ts] with your new email client to match the interface defined in [/src/features/email/server/service.interface.ts](/src/features/email/server/service.interface.ts)

## Project Structure

```
public/                    # Static assets
src/
  router.tsx               # App routing config (TanStack)
  routeTree.gen.ts         # Auto-generated by TanStack Start
  server.ts                # Server config (TanStack)
  components/              # Global components (UI and utilities)
    ui/                    # Shadcn UI components
  features/                # Feature modules (e.g. auth, todos, email)
    [feature]/
      types.ts             # Feature-specific types
      lib/                 # Third-party integrations (e.g. Resend)
      client/              # Client-side logic and hooks
        use-cases/         # TanStack Query hooks
        components/        # Feature-specific UI
      server/              # Server-side logic
        middleware.ts      # Feature middlewares
        controller/        # Server functions (callable from both client/server)
        service/           # Business logic
  lib/                     # Shared libraries
  routes/                  # File-based routes
  styles/                  # Tailwind config and theme
  utils/                   # SEO, helpers
```

## Useful Scripts

| Script                                          | Description                                             |
| ----------------------------------------------- | ------------------------------------------------------- |
| pnpm dev                                        | Starts dev server                                       |
| pnpm build                                      | Build production bundle                                 |
| pnpm start                                      | Run production bundle                                   |
| pnpm db:generate                                | Generates a new migration based on changes in db schema |
| pnpm db:migrate                                 | Migrates the db based on migration files                |
| pnpm db:studio                                  | Runs drizzle studio                                     |
| docker compose -f docker-compose.dev.yaml up -d | Runs local postgres db                                  |
